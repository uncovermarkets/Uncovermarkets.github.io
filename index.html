<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Uncover Markets - Your source for stock market analysis and insights">
    <meta name="theme-color" content="#1a1a1a">
    <meta name="author" content="Uncover Markets">
    <meta name="keywords" content="stock market, analysis, newsletter, financial insights">
    
    <title>ðŸ“Š Uncover Markets - Stock Market Analysis & Insights</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="/images/icon-192x192.png">
    <link rel="apple-touch-icon" href="/images/icon-192x192.png">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Quill Rich Text Editor for Newsletter Content -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    
    <!-- Main Stylesheets -->
    <link rel="stylesheet" href="/styles/main.css">
    <link rel="stylesheet" href="/styles/navbar-improvements.css">
    <link rel="stylesheet" href="/styles/responsive.css">
    
    <!-- Inline Critical CSS for Navbar -->
    <style>
        /* Critical: Navbar visibility */
        .navbar-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            width: 100%;
            height: 60px;
            z-index: 1000;
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        body.scrolling-down .navbar-container {
            transform: translateY(-100%);
        }
        body.scrolling-up .navbar-container {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <!-- ========================================
         NAVIGATION BAR - COMPACT & DYNAMIC
         ======================================== -->
    <nav id="navbar" class="navbar-container">
        <div class="navbar-content">
            <!-- Logo Section - Compact -->
            <div class="navbar-logo">
                <a href="/" class="logo-link">
                    <span class="logo-text">ðŸ“Š UNCOVER MARKETS</span>
                </a>
            </div>
            
            <!-- Menu Section -->
            <div class="navbar-menu">
                <a href="#home" class="nav-item" id="nav-home">HOME</a>
                <a href="#articles" class="nav-item" id="nav-articles">ARTICLES</a>
                <a href="#newsletters" class="nav-item" id="nav-newsletters">NEWSLETTERS</a>
                <button id="logout-btn" class="nav-item logout-btn" title="Logout">LOGOUT</button>
            </div>
        </div>
    </nav>

    <!-- ========================================
         WELCOME BANNER - MINIMAL WIDTH
         ======================================== -->
    <section id="welcome-banner" class="welcome-banner">
        <div class="welcome-container">
            <div class="welcome-content">
                <h1 class="welcome-title">Welcome to Uncover Markets</h1>
                <p class="welcome-subtitle" id="welcome-subtitle">
                    Your source for stock market analysis and insights
                </p>
                <p class="welcome-description" id="welcome-description">
                    Get access to exclusive premium content, in-depth analysis, and expert insights.
                </p>
            </div>
        </div>
    </section>

    <!-- ========================================
         MAIN CONTENT AREA
         ======================================== -->
    <main id="main-content" class="main-content">
        <!-- HOME SECTION -->
        <section id="home" class="section section-home">
            <div class="container">
                <h2>Latest Updates</h2>
                <div id="home-content" class="content-grid">
                    <p class="loading">Loading content...</p>
                </div>
            </div>
        </section>

        <!-- ARTICLES SECTION -->
        <section id="articles" class="section section-articles">
            <div class="container">
                <h2>Articles</h2>
                <div id="articles-content" class="content-grid">
                    <p class="loading">Loading articles...</p>
                </div>
            </div>
        </section>

        <!-- NEWSLETTERS SECTION -->
        <section id="newsletters" class="section section-newsletters">
            <div class="container">
                <h2>Newsletters</h2>
                
                <!-- Admin Panel for Newsletter Upload -->
                <div id="admin-panel" class="admin-panel hidden">
                    <h3>Newsletter Management</h3>
                    
                    <!-- Upload Form -->
                    <form id="newsletter-upload-form" class="newsletter-form">
                        <div class="form-group">
                            <label for="newsletter-title">Newsletter Title</label>
                            <input 
                                type="text" 
                                id="newsletter-title" 
                                placeholder="Enter newsletter title" 
                                required
                            >
                        </div>
                        
                        <div class="form-group">
                            <label for="newsletter-date">Date</label>
                            <input 
                                type="date" 
                                id="newsletter-date" 
                                required
                            >
                        </div>
                        
                        <div class="form-group">
                            <label for="newsletter-content">Content</label>
                            <!-- Quill Rich Text Editor -->
                            <div id="newsletter-editor" style="height: 300px;"></div>
                            <textarea id="newsletter-content" style="display:none;"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="newsletter-photo">Featured Image</label>
                            <input 
                                type="file" 
                                id="newsletter-photo" 
                                accept="image/*"
                            >
                            <div id="photo-preview" class="photo-preview"></div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Upload Newsletter</button>
                    </form>
                    
                    <!-- Flash Messages -->
                    <div id="flash-message" class="flash-message hidden"></div>
                </div>

                <!-- Newsletter List -->
                <div id="newsletters-content" class="content-grid">
                    <p class="loading">Loading newsletters...</p>
                </div>
            </div>
        </section>
    </main>

    <!-- ========================================
         FOOTER
         ======================================== -->
    <footer id="footer" class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Uncover Markets</h3>
                    <p>Your trusted source for stock market analysis and financial insights.</p>
                </div>
                
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#home">Home</a></li>
                        <li><a href="#articles">Articles</a></li>
                        <li><a href="#newsletters">Newsletters</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Contact</h3>
                    <p>Email: <a href="mailto:uncover.markets@gmail.com">uncover.markets@gmail.com</a></p>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 Uncover Markets. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- ========================================
         QUILL RICH TEXT EDITOR
         ======================================== -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <!-- ========================================
         SERVICE WORKER REGISTRATION
         ======================================== -->
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw-with-photo-flash-v8.js')
                    .then(registration => {
                        console.log('âœ“ Service Worker registered successfully');
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('âœ“ New Service Worker available');
                                    // Show update notification to user
                                    showUpdateNotification();
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('âœ— Service Worker registration failed:', error);
                    });
            });
        }
        
        function showUpdateNotification() {
            const updateBar = document.createElement('div');
            updateBar.className = 'update-notification';
            updateBar.innerHTML = `
                <p>New version available! <button onclick="window.location.reload()">Refresh</button></p>
            `;
            document.body.appendChild(updateBar);
        }
    </script>

    <!-- ========================================
         MAIN APPLICATION SCRIPT
         ======================================== -->
    <script src="/js/navbar-scroll-manager.js"></script>
    <script src="/js/app.js"></script>
    
    <!-- ========================================
         INLINE APP INITIALIZATION
         ======================================== -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸš€ Uncover Markets PWA Initializing...');
            
            // Initialize navbar scroll detection
            if (typeof NavbarScrollManager !== 'undefined') {
                new NavbarScrollManager();
                console.log('âœ“ Navbar scroll manager initialized');
            }
            
            // Initialize newsletter uploads if admin
            if (typeof initNewsletterUpload === 'function') {
                initNewsletterUpload();
                console.log('âœ“ Newsletter upload initialized');
            }
            
            // Initialize authentication
            if (typeof initAuth === 'function') {
                initAuth();
                console.log('âœ“ Authentication initialized');
            }
            
            // Initialize content loading
            if (typeof initContentLoader === 'function') {
                initContentLoader();
                console.log('âœ“ Content loader initialized');
            }
            
            console.log('âœ“ Uncover Markets PWA Ready');
        });

        // Logout handler
        document.getElementById('logout-btn')?.addEventListener('click', function(e) {
            e.preventDefault();
            
            if (confirm('Are you sure you want to logout?')) {
                // Clear local storage
                localStorage.clear();
                
                // Clear Firebase auth
                if (typeof firebase !== 'undefined' && firebase.auth) {
                    firebase.auth().signOut().then(() => {
                        console.log('âœ“ User logged out');
                        window.location.href = '/';
                    }).catch(error => {
                        console.error('Logout error:', error);
                    });
                } else {
                    window.location.href = '/';
                }
            }
        });
    </script>
</body>
</html>
